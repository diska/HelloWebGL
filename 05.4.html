<h1>Texture</h1>
<hr/><canvas id="CNVS" width="256" height="256"></canvas><hr/>
<input id="SLID" type="range" max="10"><input id="TEXT"><br/>
<textarea id="AREA" cols="40" rows="10"></textarea>
<style>textarea{background-color: bisque;}</style>
<script>
const vsrc=`attribute vec4 p;void main(){gl_PointSize=256.;gl_Position=p;}`;
const fsrc=`uniform sampler2D tex0;void main(){gl_FragColor=texture2D(tex0,gl_PointCoord);}`;
var cx0=CNVS.getContext("webgl");
const SHADV=0x8b31,SHADF=0x8b30,BBCOL=0x4000;
var vs0=cx0.createShader(SHADV);cx0.shaderSource(vs0, vsrc);cx0.compileShader(vs0);
var fs0=cx0.createShader(SHADF);cx0.shaderSource(fs0, fsrc);cx0.compileShader(fs0);
var pg0=cx0.createProgram();cx0.attachShader(pg0, vs0);cx0.attachShader(pg0, fs0);
cx0.linkProgram(pg0);
AREA.value =`Compile log for VS ${vs0}:\n${cx0.getShaderInfoLog(vs0)}`;
AREA.value+=`Compile log for FS ${fs0}:\n${cx0.getShaderInfoLog(fs0)}`;
AREA.value+=`Link log for PG ${pg0}:\n${cx0.getProgramInfoLog(pg0)}`;
var pg0tex0=cx0.getUniformLocation(pg0, "tex0");
cx0.pixelStorei(cx0.UNPACK_ALIGNMENT, 1);	// これしないと4x4未満の時エラーになる。
// 以上が「GLSLプログラム」定義。以下で「GLSLプログラム」にデータを与える。
const TXT00=0x84c0,TXT2D=0x0de1,FRGBA=0x1908,FLUMI=0x1909,TYPUB=0x1401;
cx0.useProgram(pg0);
var tx0=cx0.createTexture();
cx0.activeTexture(TXT00+0);cx0.bindTexture(TXT2D, tx0);
cx0.uniform1i(pg0tex0, 0);
function draw(){
	var sz=Math.pow(2, SLID.value);	TEXT.value=sz;	// 1,2,4,8,16...
	var data=getImageData(sz);
	cx0.activeTexture(TXT00+0);{
		cx0.texImage2D(TXT2D, 0, FLUMI, sz, sz, 0, FLUMI, TYPUB, data);
		cx0.generateMipmap(TXT2D);
	}
	cx0.clearColor(0,0.3,0,1);cx0.clear(BBCOL);
	cx0.drawArrays(0, 0,1);
};	SLID.addEventListener("input", draw);	draw();
// テキトウな「sz*szサイズのモノクロ(LUMINANCE)画像」のUint8Arrayデータ生成。
function getImageData(sz=256){
	var data=new Uint8Array(sz*sz);	data.fill(0x3f,0,sz*sz);
	for(var i=0;i<sz;i++){	plot(i,Math.sin(i*2*Math.PI/sz)*sz/2+sz/2);}
	return data;
	function plot(x,y){	data[Math.floor(y)*sz+x]=0xff;}
}
</script>